# 需求文档

## 简介

区块链证书存证系统是一个基于 FISCO BCOS 区块链的证书管理平台，提供证书申请、审批、存证、查询和验证的完整流程。系统采用前后端分离架构，前端使用 Vue 3 + TypeScript，后端使用 Spring Boot，通过区块链技术确保证书数据的不可篡改性，通过 IPFS 实现证书文件的去中心化存储。

## 术语表

- **系统**: 区块链证书存证系统
- **学生**: 证书申请者角色
- **学院老师**: 负责初审的审批者角色
- **学校老师**: 负责终审的审批者角色
- **管理员**: 系统管理者角色
- **证书编号**: 全局唯一的证书标识符
- **CID**: IPFS 内容标识符，用于定位存储在 IPFS 上的文件
- **数字签名**: 使用私钥对审批数据进行的加密签名
- **存证**: 将证书关键元数据记录到区块链的过程
- **核验**: 验证证书真伪的过程
- **JWT**: JSON Web Token，用于用户身份认证的令牌
- **审批流**: 证书从申请到通过的审批节点序列
- **交易哈希**: 区块链交易的唯一标识符
- **区块高度**: 区块在区块链中的位置编号

## 需求

### 需求 1：用户认证与授权

**用户故事**: 作为系统用户，我希望能够安全地登录系统并根据我的角色访问相应的功能，以便保护系统数据安全。

#### 验收标准

1. WHEN 用户输入有效的账号、密码和验证码 THEN 系统 SHALL 验证凭据并签发 JWT 令牌
2. WHEN 用户输入无效的凭据 THEN 系统 SHALL 拒绝登录并显示错误提示
3. WHEN 用户选择"记住密码"选项 THEN 系统 SHALL 在本地存储加密的登录凭据
4. WHEN 用户访问需要权限的功能 THEN 系统 SHALL 验证用户角色并允许或拒绝访问
5. WHEN 用户的 JWT 令牌过期 THEN 系统 SHALL 自动刷新令牌或要求重新登录
6. WHEN 用户连续输入错误密码超过 5 次 THEN 系统 SHALL 锁定账户 30 分钟
7. WHEN 用户点击验证码图片 THEN 系统 SHALL 生成并显示新的验证码

### 需求 2：证书申请流程

**用户故事**: 作为学生，我希望能够在线提交证书申请并上传证明材料，以便获得官方认证的证书。

#### 验收标准

1. WHEN 学生填写申请表单并上传 1 到 3 个证明文件 THEN 系统 SHALL 创建申请记录并将文件存储到 IPFS
2. WHEN 学生上传的文件格式不是 PDF、JPG 或 PNG THEN 系统 SHALL 拒绝上传并提示支持的格式
3. WHEN 学生提交申请 THEN 系统 SHALL 自动填充学生的个人信息到申请表单
4. WHEN 学生查看申请列表 THEN 系统 SHALL 显示所有申请记录及其当前状态
5. WHEN 学生取消未审批的申请 THEN 系统 SHALL 删除申请记录和 IPFS 上的文件
6. WHEN 学生搜索申请记录 THEN 系统 SHALL 根据证书类型或状态筛选并显示结果

### 需求 3：两级审批流程

**用户故事**: 作为审批老师，我希望能够审核学生的证书申请并进行数字签名，以便确保审批的真实性和不可否认性。

#### 验收标准

1. WHEN 学院老师审批申请 THEN 系统 SHALL 使用老师的私钥对审批数据进行数字签名
2. WHEN 学院老师通过初审 THEN 系统 SHALL 将申请状态更新为待学校审批并通知学校老师
3. WHEN 学院老师驳回申请 THEN 系统 SHALL 将申请状态更新为已驳回并通知学生
4. WHEN 学校老师通过终审 THEN 系统 SHALL 触发证书生成和区块链存证流程
5. WHEN 审批老师查看待审列表 THEN 系统 SHALL 仅显示分配给该老师的待审申请
6. WHEN 审批老师输入审批意见 THEN 系统 SHALL 记录意见并关联到审批记录
7. WHEN 审批老师查看申请详情 THEN 系统 SHALL 显示学生信息、申请内容、证明材料和审批历史

### 需求 4：证书生成与管理

**用户故事**: 作为系统，我希望在审批通过后自动生成唯一的证书并管理其生命周期，以便提供可靠的证书服务。

#### 验收标准

1. WHEN 学校老师通过终审 THEN 系统 SHALL 生成全局唯一的证书编号
2. WHEN 系统生成证书编号 THEN 系统 SHALL 使用证书模板渲染证书内容并生成 PDF 文件
3. WHEN 系统生成证书 PDF THEN 系统 SHALL 将 PDF 文件上传到 IPFS 并获取 CID
4. WHEN 系统获取证书 CID THEN 系统 SHALL 将证书元数据（编号、CID、哈希值）存储到数据库
5. WHEN 管理员撤销证书 THEN 系统 SHALL 将证书状态更新为已撤销
6. WHEN 用户查询已撤销的证书 THEN 系统 SHALL 显示证书已撤销的状态

### 需求 5：区块链存证

**用户故事**: 作为系统，我希望将证书关键信息存储到区块链上，以便提供不可篡改的存证证明。

#### 验收标准

1. WHEN 证书生成完成 THEN 系统 SHALL 调用智能合约将证书哈希值上链
2. WHEN 智能合约执行成功 THEN 系统 SHALL 获取交易哈希和区块高度
3. WHEN 系统获取交易回执 THEN 系统 SHALL 将交易哈希、区块高度和时间戳记录到数据库
4. WHEN 区块链节点不可用 THEN 系统 SHALL 记录错误日志并重试存证操作
5. WHEN 系统监控区块链网络 THEN 系统 SHALL 定期检查节点状态和交易成功率

### 需求 6：证书核验

**用户故事**: 作为公众用户，我希望能够通过证书编号验证证书的真伪，以便确认证书的有效性。

#### 验收标准

1. WHEN 用户输入证书编号 THEN 系统 SHALL 在数据库中查询证书记录
2. WHEN 数据库中存在证书记录 THEN 系统 SHALL 从区块链验证证书哈希值
3. WHEN 区块链验证通过 THEN 系统 SHALL 从 IPFS 获取证书文件并验证完整性
4. WHEN 三级验证全部通过 THEN 系统 SHALL 显示验证成功结果和证书详情
5. WHEN 任一验证失败 THEN 系统 SHALL 显示验证失败原因
6. WHEN 用户查看验证结果 THEN 系统 SHALL 提供证书 PDF 下载链接
7. WHEN 用户访问核验页面 THEN 系统 SHALL 允许未登录用户访问

### 需求 7：文件存储与访问

**用户故事**: 作为系统，我希望使用 IPFS 存储证书文件，以便实现去中心化存储和文件的永久可访问性。

#### 验收标准

1. WHEN 系统上传文件到 IPFS THEN 系统 SHALL 获取文件的唯一 CID
2. WHEN 系统需要访问文件 THEN 系统 SHALL 使用 CID 从 IPFS 检索文件
3. WHEN 用户下载证书 THEN 系统 SHALL 验证用户权限后提供文件下载
4. WHEN IPFS 节点不可用 THEN 系统 SHALL 记录错误并提示用户稍后重试
5. WHEN 系统删除申请 THEN 系统 SHALL 从 IPFS 删除关联的证明材料文件

### 需求 8：用户管理

**用户故事**: 作为管理员，我希望能够管理系统用户账号和权限，以便控制系统访问和维护用户数据。

#### 验收标准

1. WHEN 管理员创建新用户 THEN 系统 SHALL 验证用户信息并分配指定角色
2. WHEN 管理员编辑用户信息 THEN 系统 SHALL 更新用户数据并记录操作日志
3. WHEN 管理员重置用户密码 THEN 系统 SHALL 生成临时密码并通知用户
4. WHEN 管理员禁用用户账号 THEN 系统 SHALL 阻止该用户登录系统
5. WHEN 管理员删除用户 THEN 系统 SHALL 软删除用户记录并保留历史数据
6. WHEN 管理员搜索用户 THEN 系统 SHALL 根据用户名、姓名或角色筛选并显示结果
7. WHEN 管理员查看用户列表 THEN 系统 SHALL 分页显示所有用户

### 需求 9：学院与审批流配置

**用户故事**: 作为管理员，我希望能够配置学院信息和审批流程，以便适应不同的组织结构和审批需求。

#### 验收标准

1. WHEN 管理员添加学院 THEN 系统 SHALL 创建学院记录并支持添加专业
2. WHEN 管理员为学院指定审批老师 THEN 系统 SHALL 将该老师关联到学院的审批流
3. WHEN 管理员编辑学院信息 THEN 系统 SHALL 更新学院数据
4. WHEN 管理员删除学院 THEN 系统 SHALL 检查是否有关联数据并提示确认
5. WHEN 管理员配置审批流 THEN 系统 SHALL 允许启用或禁用学校审批环节
6. WHEN 管理员保存审批流配置 THEN 系统 SHALL 应用新配置到后续申请

### 需求 10：证书模板管理

**用户故事**: 作为管理员，我希望能够管理证书模板，以便生成符合要求的证书文档。

#### 验收标准

1. WHEN 管理员上传模板背景图 THEN 系统 SHALL 验证图片格式并存储模板
2. WHEN 管理员添加模板字段 THEN 系统 SHALL 定义字段位置和样式
3. WHEN 管理员设置默认模板 THEN 系统 SHALL 将该模板标记为默认并用于证书生成
4. WHEN 管理员预览模板 THEN 系统 SHALL 使用示例数据渲染模板效果
5. WHEN 管理员删除模板 THEN 系统 SHALL 检查是否为默认模板并提示确认

### 需求 11：系统日志与审计

**用户故事**: 作为管理员，我希望能够查看系统操作日志，以便追踪用户行为和排查问题。

#### 验收标准

1. WHEN 用户执行关键操作 THEN 系统 SHALL 记录操作时间、操作人、操作类型和操作内容
2. WHEN 管理员查看日志列表 THEN 系统 SHALL 分页显示所有日志记录
3. WHEN 管理员按时间筛选日志 THEN 系统 SHALL 显示指定时间范围内的日志
4. WHEN 管理员按操作人搜索日志 THEN 系统 SHALL 显示该用户的所有操作记录
5. WHEN 管理员查看日志详情 THEN 系统 SHALL 显示完整的操作信息
6. WHEN 管理员导出日志 THEN 系统 SHALL 生成 Excel 格式的日志文件

### 需求 12：数据可视化

**用户故事**: 作为管理员，我希望能够查看系统数据统计和可视化图表，以便了解系统运行状况和业务数据。

#### 验收标准

1. WHEN 管理员访问可视化大屏 THEN 系统 SHALL 显示证书颁发数量统计
2. WHEN 管理员查看审批统计 THEN 系统 SHALL 显示待审批、已通过、已驳回的数量
3. WHEN 管理员查看区块链监控 THEN 系统 SHALL 显示节点状态、交易统计和区块同步进度
4. WHEN 管理员生成报表 THEN 系统 SHALL 支持导出 Excel 或 PDF 格式
5. WHEN 管理员切换全屏模式 THEN 系统 SHALL 以全屏方式显示可视化大屏

### 需求 13：响应式界面设计

**用户故事**: 作为用户，我希望系统界面能够适应不同屏幕尺寸并提供良好的交互体验，以便在各种设备上使用系统。

#### 验收标准

1. WHEN 用户在不同设备访问系统 THEN 系统 SHALL 根据屏幕尺寸调整布局
2. WHEN 用户查看数据列表 THEN 系统 SHALL 使用底部分页器避免长列表滚动
3. WHEN 用户点击详情按钮 THEN 系统 SHALL 以模态框形式显示完整信息
4. WHEN 用户查看除验证页面外的其他页面 THEN 系统 SHALL 避免页面滚动
5. WHEN 用户输入表单数据 THEN 系统 SHALL 提供实时验证反馈

### 需求 14：个人中心

**用户故事**: 作为用户，我希望能够查看和修改个人信息，以便管理我的账户。

#### 验收标准

1. WHEN 用户访问个人中心 THEN 系统 SHALL 显示用户的基本信息
2. WHEN 用户修改密码 THEN 系统 SHALL 验证原密码并更新新密码
3. WHEN 用户更新个人信息 THEN 系统 SHALL 保存修改并显示成功提示

### 需求 15：我的证书查询

**用户故事**: 作为学生，我希望能够查看我已获得的所有证书，以便管理和下载我的证书。

#### 验收标准

1. WHEN 学生访问我的证书页面 THEN 系统 SHALL 显示该学生的所有有效证书
2. WHEN 学生搜索证书 THEN 系统 SHALL 根据证书编号或类型筛选结果
3. WHEN 学生按时间筛选 THEN 系统 SHALL 显示指定日期范围内的证书
4. WHEN 学生查看证书详情 THEN 系统 SHALL 显示完整的证书信息、区块链存证信息和 IPFS 信息
5. WHEN 学生下载证书 THEN 系统 SHALL 从 IPFS 获取证书 PDF 并提供下载

### 需求 16：审批统计

**用户故事**: 作为审批老师，我希望能够查看我的审批统计数据，以便了解我的工作量和审批情况。

#### 验收标准

1. WHEN 审批老师访问审批页面 THEN 系统 SHALL 显示待我审批、我已通过、我已驳回和总审批量的统计
2. WHEN 审批老师查看我的审批页面 THEN 系统 SHALL 显示该老师的所有审批记录
3. WHEN 审批老师搜索审批记录 THEN 系统 SHALL 根据申请人、证书类型或时间筛选结果

### 需求 17：区块链配置管理

**用户故事**: 作为管理员，我希望能够配置和监控区块链网络连接，以便确保存证功能正常运行。

#### 验收标准

1. WHEN 管理员访问区块链配置页面 THEN 系统 SHALL 显示当前区块链网络状态
2. WHEN 管理员查看配置信息 THEN 系统 SHALL 显示合约地址和节点连接信息
3. WHEN 管理员点击同步数据 THEN 系统 SHALL 从区块链同步最新的存证记录
4. WHEN 区块链节点连接失败 THEN 系统 SHALL 显示错误状态和错误信息
